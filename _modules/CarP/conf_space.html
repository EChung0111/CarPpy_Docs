

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CarP.conf_space &mdash; CarPpy 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=92fd9be5" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=2709fde1"></script>
      <script src="../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            CarPpy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">CarPpy</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">CarPpy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">CarP.conf_space</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for CarP.conf_space</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">.conformer</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.utilities</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">itemgetter</span><span class="p">,</span> <span class="n">attrgetter</span>
<span class="kn">from</span> <span class="nn">scipy.cluster.hierarchy</span> <span class="kn">import</span> <span class="n">dendrogram</span><span class="p">,</span> <span class="n">linkage</span><span class="p">,</span> <span class="n">cut_tree</span>

<div class="viewcode-block" id="Space">
<a class="viewcode-back" href="../../CarP.html#CarP.conf_space.Space">[docs]</a>
<span class="k">class</span> <span class="nc">Space</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;A conformational space consisting of all conformers found in specified directory.</span>
<span class="sd">    The directory tree should have a structure:</span>
<span class="sd">    &#39;molecule&#39;/*/*log</span>
<span class="sd">    if directory &#39;molecule&#39; holds a directory &#39;experimental&#39;, an attibute self.expIR is </span>
<span class="sd">    created using the data found there. </span>
<span class="sd">    for different molecules, different lists can (meaning should!) be made.</span>

<span class="sd">    Generally constructing a conformer space is the first thing to do when using this package.</span>
<span class="sd">    A conformer space will generate a list of conformers. </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_temp</span> <span class="o">=</span> <span class="mf">298.15</span> <span class="c1">#standard temperature Kelvin</span>
    <span class="n">_kb</span><span class="o">=</span><span class="mf">0.0019872036</span>
    <span class="n">_kT</span><span class="o">=</span><span class="mf">0.0019872036</span><span class="o">*</span><span class="n">_temp</span> <span class="c1">#boltzmann</span>
    <span class="n">_Ha2kcal</span><span class="o">=</span><span class="mf">627.5095</span>  

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">load</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">software</span><span class="o">=</span><span class="s1">&#39;g16&#39;</span><span class="p">,</span> <span class="n">sort_atoms</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">determine_PGs</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">distXX</span><span class="o">=</span><span class="mf">1.65</span><span class="p">,</span> <span class="n">distXH</span><span class="o">=</span><span class="mf">1.25</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="k">try</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> 
            <span class="k">if</span> <span class="n">load</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span> 
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:10s}</span><span class="s2"> directory already exists, load existing data&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">load_dir</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">software</span><span class="o">=</span><span class="n">software</span><span class="p">,</span> <span class="n">sort_atoms</span> <span class="o">=</span> <span class="n">sort_atoms</span><span class="p">,</span> <span class="n">determine_PGs</span> <span class="o">=</span> <span class="n">determine_PGs</span><span class="p">,</span> <span class="n">distXX</span><span class="o">=</span><span class="n">distXX</span><span class="p">,</span> <span class="n">distXH</span><span class="o">=</span><span class="n">distXH</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="k">pass</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">         </span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prints a nice table with coded molecular values</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;H&#39;</span><span class="p">):</span> 
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%20s%20s%20s%20s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;E [Ha]&#39;</span><span class="p">,</span> <span class="s1">&#39;H [Ha]&#39;</span><span class="p">,</span> <span class="s1">&#39;F [Ha]&#39;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%20s%20.8f%20.8f%20.8f</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">_id</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">E</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">H</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">F</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%20s%20s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;E [Ha]&#39;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>  
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">):</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%20s%20.8f</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">_id</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">E</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%20s%20s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">_id</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">))</span>

        <span class="k">return</span> <span class="s1">&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">select</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Finds a specific conformer in the space</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">select</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">rval</span> <span class="o">=</span> <span class="nb">list</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">select</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">rval</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">select</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">rval</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">list</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">select</span> <span class="p">]</span> 

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">select</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="n">rval</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Space</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">select</span><span class="p">)</span>

        <span class="n">rret</span> <span class="o">=</span> <span class="n">Space</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">load</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">rret</span><span class="o">.</span><span class="vm">__dict__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="n">rval</span><span class="p">:</span> <span class="n">rret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rret</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">space</span><span class="p">):</span>

        <span class="n">new_space</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="n">space</span><span class="p">:</span> 
            <span class="n">new_space</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">conf</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">new_space</span>

    <span class="k">def</span> <span class="nf">__getslice__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;gets a set of conformers in the space</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getitem</span><span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">))</span>

<div class="viewcode-block" id="Space.load_dir">
<a class="viewcode-back" href="../../CarP.html#CarP.conf_space.Space.load_dir">[docs]</a>
    <span class="k">def</span> <span class="nf">load_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">software</span><span class="o">=</span><span class="s1">&#39;g16&#39;</span><span class="p">,</span> <span class="n">carb</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">sort_atoms</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">determine_PGs</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">distXX</span><span class="o">=</span><span class="mf">1.65</span><span class="p">,</span> <span class="n">distXH</span><span class="o">=</span><span class="mf">1.25</span><span class="p">,</span> <span class="n">conf_n</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads a directory with data files to be processed. The path is just the name of the directory, the function will handle the presence of multiple directories within it.</span>

<span class="sd">        :param path: (string) this is the path to the directory with all the conformer data. This directory should be filled with other directories with the intended name of the conformer and it&#39;s .xyz and input.log files</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading </span><span class="si">{0:30s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
        <span class="c1">#check if this is wont lead to an error if the path doesnt exist </span>

        <span class="c1">#self.logfiles_dir.append(path)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">distXX</span> <span class="o">=</span> <span class="n">distXX</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distXH</span> <span class="o">=</span> <span class="n">distXH</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">dirname</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ifiles</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">dirname</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">ifiles</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.log&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.xyz&#39;</span><span class="p">):</span>

                            <span class="n">loaded</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">path</span><span class="p">,</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">filename</span><span class="p">]),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]:</span>

                                <span class="k">if</span> <span class="n">software</span> <span class="o">==</span> <span class="s1">&#39;g16&#39;</span> <span class="ow">and</span>  <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Normal&#39;</span><span class="p">,</span>  <span class="n">line</span><span class="p">):</span>

                                    <span class="n">conf</span> <span class="o">=</span> <span class="n">Conformer</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">path</span><span class="p">,</span> <span class="n">dirname</span><span class="p">]))</span>
                                    <span class="n">loaded</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">load_log</span><span class="p">(</span><span class="n">software</span><span class="o">=</span><span class="s2">&quot;g16&quot;</span><span class="p">)</span>

                                <span class="k">elif</span> <span class="n">software</span> <span class="o">==</span> <span class="s1">&#39;orca&#39;</span><span class="p">:</span>

                                    <span class="n">conf</span> <span class="o">=</span> <span class="n">Conformer</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">path</span><span class="p">,</span> <span class="n">dirname</span><span class="p">]))</span>
                                    <span class="n">loaded</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">load_log</span><span class="p">(</span><span class="n">software</span><span class="o">=</span><span class="s2">&quot;orca&quot;</span><span class="p">)</span>

                                <span class="k">elif</span> <span class="n">software</span> <span class="o">==</span> <span class="s1">&#39;fhiaims&#39;</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Have a nice day.&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>

                                    <span class="n">conf</span> <span class="o">=</span> <span class="n">Conformer</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">path</span><span class="p">,</span> <span class="n">dirname</span><span class="p">]))</span>
                                    <span class="n">loaded</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">load_log</span><span class="p">(</span><span class="n">software</span><span class="o">=</span><span class="s2">&quot;fhiaims&quot;</span><span class="p">)</span>

                                <span class="k">elif</span> <span class="n">software</span> <span class="o">==</span> <span class="s1">&#39;xyz&#39;</span><span class="p">:</span>

                                    <span class="n">conf</span> <span class="o">=</span> <span class="n">Conformer</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">path</span><span class="p">,</span> <span class="n">dirname</span><span class="p">]))</span>
                                    <span class="n">loaded</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">load_log</span><span class="p">(</span><span class="n">software</span><span class="o">=</span><span class="s2">&quot;xyz&quot;</span><span class="p">)</span>

                                <span class="k">elif</span> <span class="n">software</span> <span class="o">==</span> <span class="s1">&#39;crest&#39;</span><span class="p">:</span>

                                    <span class="n">file_line_list</span> <span class="o">=</span> <span class="p">[]</span>
                                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;crest_conformers.xyz&quot;</span><span class="p">]),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                                        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                                            <span class="n">file_line_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

                                        <span class="n">line_1</span> <span class="o">=</span> <span class="n">file_line_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                                        <span class="n">conf_array</span> <span class="o">=</span> <span class="p">[]</span>
                                        <span class="n">conf_line_list</span> <span class="o">=</span> <span class="p">[]</span>

                                        <span class="k">for</span> <span class="n">line_num</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">file_line_list</span><span class="p">):</span>

                                            <span class="k">if</span> <span class="n">line</span> <span class="o">==</span> <span class="n">line_1</span> <span class="ow">and</span> <span class="n">line_num</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                                                <span class="n">conf_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf_line_list</span><span class="p">)</span>
                                                <span class="n">conf_line_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">]</span>

                                            <span class="k">else</span><span class="p">:</span>
                                                <span class="n">conf_line_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

                                        <span class="k">for</span> <span class="n">conf_num</span><span class="p">,</span> <span class="n">conf</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">conf_array</span><span class="p">):</span>

                                            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;conf_</span><span class="si">{</span><span class="n">conf_num</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
                                            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;conf_</span><span class="si">{</span><span class="n">conf_num</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;geometry1.xyz&#39;</span><span class="p">),</span>
                                                      <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                                                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">conf</span><span class="p">:</span>
                                                    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

                                    <span class="k">if</span> <span class="n">conf_n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                        <span class="n">conf</span> <span class="o">=</span> <span class="n">Conformer</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">path</span><span class="p">,</span> <span class="n">dirname</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;conf_</span><span class="si">{</span><span class="n">conf_n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]))</span>
                                        <span class="n">loaded</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">load_log</span><span class="p">(</span><span class="n">software</span><span class="o">=</span><span class="s2">&quot;xyz&quot;</span><span class="p">)</span>

                                <span class="k">else</span><span class="p">:</span> <span class="k">continue</span>

                                <span class="k">if</span> <span class="n">loaded</span><span class="p">:</span> 

                                    <span class="n">conf</span><span class="o">.</span><span class="n">connectivity_matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distXX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">distXH</span><span class="p">)</span>
                                    <span class="n">conf</span><span class="o">.</span><span class="n">distXX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distXX</span> <span class="p">;</span> <span class="n">conf</span><span class="o">.</span><span class="n">distXH</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distXH</span>

                                    <span class="k">if</span> <span class="n">carb</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span>  <span class="n">conf</span><span class="o">.</span><span class="n">Nmols</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

                                        <span class="n">conf</span><span class="o">.</span><span class="n">assign_atoms</span><span class="p">(</span> <span class="n">sort_atoms</span> <span class="o">=</span> <span class="n">sort_atoms</span><span class="p">,</span> <span class="n">deter_PGs</span> <span class="o">=</span> <span class="n">determine_PGs</span><span class="p">)</span> <span class="p">;</span> 
                                        <span class="n">conf</span><span class="o">.</span><span class="n">measure_c6</span><span class="p">()</span>  
                                        <span class="n">conf</span><span class="o">.</span><span class="n">measure_glycosidic</span><span class="p">()</span>  
                                        <span class="n">conf</span><span class="o">.</span><span class="n">measure_ring</span><span class="p">()</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>

                                    <span class="k">elif</span> <span class="n">carb</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">conf</span><span class="o">.</span><span class="n">Nmols</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span> 
  
                                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Disconnected Carbohydrate, deleting </span><span class="si">{0:10s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">_id</span><span class="p">))</span>
                                        <span class="k">del</span> <span class="n">conf</span>

                                    <span class="k">else</span><span class="p">:</span>

                                        <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>

                                    <span class="k">break</span></div>


<div class="viewcode-block" id="Space.load_exp">
<a class="viewcode-back" href="../../CarP.html#CarP.conf_space.Space.load_exp">[docs]</a>
    <span class="k">def</span> <span class="nf">load_exp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">ir_resolution</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Selects the experimental conformer that other conformers will be compared to. Creates/updates the self.expIR member of this class</span>

<span class="sd">        :param path: (string) the path to a specific exp.dat file, the path should not just go to the general dir but also include the filename</span>
<span class="sd">        :param ir_resolution: (float) Resolution of the plot. The value is used to make a grid and the ir_resolution is the number of values skipped between each plotted point. Ex: assuming exp is an array size 10 exp = [1...10], and ir_resolution is 3 the values plotted will be [1,4,7]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ir_resolution</span> <span class="o">=</span> <span class="n">ir_resolution</span> 
        <span class="n">expIR</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">new_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">expIR</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">expIR</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ir_resolution</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expIR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">new_grid</span><span class="p">,</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">griddata</span><span class="p">(</span><span class="n">expIR</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">expIR</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">new_grid</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)))</span><span class="o">.</span><span class="n">T</span> <span class="c1">#espec - experimental spectrum</span></div>


<div class="viewcode-block" id="Space.dump_xyz">
<a class="viewcode-back" href="../../CarP.html#CarP.conf_space.Space.dump_xyz">[docs]</a>
    <span class="k">def</span> <span class="nf">dump_xyz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;all_structures.xyz&#39;</span><span class="p">]),</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out</span><span class="p">:</span> 

            <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:5d}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">NAtoms</span><span class="p">))</span>
                <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:30s}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">_id</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">NAtoms</span><span class="p">):</span>
                    <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:3s}{1:12.3f}{2:12.3f}{3:12.3f}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">at</span><span class="p">],</span> <span class="n">conf</span><span class="o">.</span><span class="n">xyz</span><span class="p">[</span><span class="n">at</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">conf</span><span class="o">.</span><span class="n">xyz</span><span class="p">[</span><span class="n">at</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">conf</span><span class="o">.</span><span class="n">xyz</span><span class="p">[</span><span class="n">at</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span></div>


<div class="viewcode-block" id="Space.load_models">
<a class="viewcode-back" href="../../CarP.html#CarP.conf_space.Space.load_models">[docs]</a>
    <span class="k">def</span> <span class="nf">load_models</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">sort_atoms</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">deter_PGs</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">distXH</span><span class="o">=</span><span class="mf">1.25</span><span class="p">,</span> <span class="n">distXX</span><span class="o">=</span><span class="mf">1.65</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads a set of specific models used of analysis</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="o">+</span><span class="n">path</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">dirname</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ifiles</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">dirname</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">ifiles</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.xyz&#39;</span><span class="p">):</span>
                            <span class="n">conf</span> <span class="o">=</span> <span class="n">Conformer</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">path</span><span class="p">,</span> <span class="n">dirname</span><span class="p">]))</span>
                            <span class="n">conf</span><span class="o">.</span><span class="n">load_log</span><span class="p">(</span><span class="n">software</span><span class="o">=</span><span class="s2">&quot;xyz&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Nmodels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Analyzing Models:&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">:</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:10s}</span><span class="s2">:   &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">_id</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">conf</span><span class="o">.</span><span class="n">ring</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">;</span> <span class="n">conf</span><span class="o">.</span><span class="n">ring_angle</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">;</span> <span class="n">conf</span><span class="o">.</span><span class="n">dih_angle</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">conf</span><span class="o">.</span><span class="n">distXH</span><span class="o">=</span><span class="n">distXH</span> <span class="p">;</span> <span class="n">conf</span><span class="o">.</span><span class="n">distXX</span><span class="o">=</span><span class="n">distXX</span>
            <span class="n">conf</span><span class="o">.</span><span class="n">connectivity_matrix</span><span class="p">(</span><span class="n">distXX</span><span class="o">=</span><span class="n">distXX</span><span class="p">,</span> <span class="n">distXH</span><span class="o">=</span><span class="n">distXH</span><span class="p">)</span> <span class="p">;</span> 
            <span class="n">conf</span><span class="o">.</span><span class="n">assign_atoms</span><span class="p">(</span><span class="n">sort_atoms</span> <span class="o">=</span> <span class="n">sort_atoms</span><span class="p">,</span> <span class="n">deter_PGs</span> <span class="o">=</span> <span class="n">deter_PGs</span><span class="p">)</span> <span class="p">;</span> 
            <span class="n">conf</span><span class="o">.</span><span class="n">measure_c6</span><span class="p">()</span> <span class="p">;</span> <span class="n">conf</span><span class="o">.</span><span class="n">measure_ring</span><span class="p">()</span> <span class="p">;</span> <span class="n">conf</span><span class="o">.</span><span class="n">measure_glycosidic</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="s1">&#39;graph&#39;</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">conf</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
                    <span class="n">edge</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">e</span><span class="p">]</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:1d}</span><span class="s2">-&gt;</span><span class="si">{1:1d}</span><span class="s2">: </span><span class="si">{2:6s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;linker_type&#39;</span><span class="p">]),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span> 
                <span class="n">conf</span><span class="o">.</span><span class="n">topol</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span>
                <span class="c1">#the iteration of the graphs edges can lead to bug because the order of the list is unknown. For the conformers to have the same shape the list must have the same content in the same order.</span>
                <span class="n">conf_links</span> <span class="o">=</span>  <span class="p">[</span> <span class="n">conf</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;linker_type&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">conf</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">:</span>
                    <span class="n">m_links</span> <span class="o">=</span> <span class="p">[</span> <span class="n">m</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;linker_type&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span> <span class="p">]</span>
                    <span class="n">mat</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">conn_mat</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">conn_mat</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span> <span class="ow">and</span> <span class="n">conf_links</span> <span class="o">==</span> <span class="n">m_links</span> <span class="ow">and</span> <span class="n">m</span><span class="o">.</span><span class="n">anomer</span> <span class="o">==</span> <span class="n">conf</span><span class="o">.</span><span class="n">anomer</span> <span class="p">:</span>
                        <span class="n">conf</span><span class="o">.</span><span class="n">topol</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">topol</span>
                        <span class="k">break</span>
                        <span class="c1">#return 0</span>
                    <span class="k">elif</span> <span class="n">conf_links</span> <span class="o">==</span> <span class="n">m_links</span> <span class="ow">and</span> <span class="n">m</span><span class="o">.</span><span class="n">anomer</span> <span class="o">==</span> <span class="n">conf</span><span class="o">.</span><span class="n">anomer</span><span class="p">:</span> 
                        <span class="n">atc</span> <span class="o">=</span> <span class="mi">0</span> 
                        <span class="n">acm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="n">acm</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">conf</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">==</span> <span class="s1">&#39;H&#39;</span> <span class="ow">or</span> <span class="n">conf</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">at</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">==</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span>
                                <span class="n">atc</span> <span class="o">+=</span> <span class="mi">1</span> 
                        <span class="k">if</span> <span class="n">atc</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">acm</span><span class="p">):</span>
                                <span class="n">conf</span><span class="o">.</span><span class="n">topol</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">topol</span><span class="o">+</span><span class="s1">&#39;_Hs&#39;</span>
                                <span class="k">break</span></div>

                    
<span class="c1">#if np.array_equal(conf.conn_mat, m.conn_mat) and conf_links == m_links : conf.topol = m.topol</span>

<div class="viewcode-block" id="Space.load_Fmaps">
<a class="viewcode-back" href="../../CarP.html#CarP.conf_space.Space.load_Fmaps">[docs]</a>
    <span class="k">def</span> <span class="nf">load_Fmaps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">Temp</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads a set of free energy maps for the glycosidic linkages located in path</span>
<span class="sd">           The directory name that contains eps file with the map should be the linkage.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">load_linkage</span><span class="p">(</span><span class="n">linkage_path</span><span class="p">,</span> <span class="n">Temp</span><span class="p">):</span>
           
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">linkage_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> 
            <span class="n">pattern</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">;</span> <span class="n">matrix_lett</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">matrix_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>

                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d\s\d\b)&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="ow">and</span> <span class="n">grid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">grid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">pattern</span> <span class="o">=</span> <span class="n">grid</span> <span class="o">*</span> <span class="s1">&#39;[A-Z]&#39;</span>

                <span class="k">if</span> <span class="n">pattern</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                    <span class="n">replL1</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;,&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="n">replL2</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="n">matrix_lett</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">replL2</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span>

                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;((&quot;.*&quot;)[0-9])&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span> 
                    <span class="n">replL1</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span> 
                    <span class="n">letters</span><span class="p">,</span> <span class="n">energy</span> <span class="o">=</span> <span class="n">values</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">replL1</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> <span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">replL1</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">])</span>
                    <span class="n">matrix_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">letters</span><span class="p">,</span><span class="n">energy</span><span class="p">))</span>

            <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">[</span><span class="n">grid</span><span class="p">,</span> <span class="n">grid</span> <span class="p">]</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid</span><span class="p">):</span>
                    <span class="n">matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">matrix_dict</span><span class="p">[</span><span class="n">matrix_lett</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]]</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kb</span><span class="o">*</span><span class="n">Temp</span><span class="p">))</span>
            <span class="n">matrix</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
            <span class="c1">#print(np.sum(matrix))</span>
            <span class="k">return</span> <span class="n">matrix</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">Temp</span><span class="p">:</span> <span class="n">Temp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_temp</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">linkages</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="o">+</span><span class="n">path</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">dirname</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ifiles</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">dirname</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">ifiles</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.xpm&#39;</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">linkages</span><span class="p">[</span><span class="n">dirname</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_linkage</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">path</span><span class="p">,</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">filename</span><span class="p">]),</span> <span class="n">Temp</span> <span class="o">=</span> <span class="n">Temp</span><span class="p">)</span></div>


<div class="viewcode-block" id="Space.set_theory">
<a class="viewcode-back" href="../../CarP.html#CarP.conf_space.Space.set_theory">[docs]</a>
    <span class="k">def</span> <span class="nf">set_theory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">software</span><span class="o">=</span><span class="s1">&#39;g16&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parameters for simulations</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">software</span> <span class="o">==</span> <span class="s1">&#39;g16&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">theory</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="s1">&#39;PBE1PBE&#39;</span><span class="p">,</span> 
                        <span class="s1">&#39;basis_set&#39;</span><span class="p">:</span><span class="s1">&#39;6-31+G(d,p)&#39;</span><span class="p">,</span> 
                        <span class="s1">&#39;jobtype&#39;</span><span class="p">:</span><span class="s1">&#39;opt freq&#39;</span><span class="p">,</span> 
                        <span class="s1">&#39;disp&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> 
                        <span class="s1">&#39;other_options&#39;</span><span class="p">:</span><span class="s1">&#39;int=(grid=99590)&#39;</span><span class="p">,</span> 
                        <span class="s1">&#39;charge&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> 
                        <span class="s1">&#39;multiplicity&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> 
                        <span class="s1">&#39;nprocs&#39;</span><span class="p">:</span><span class="mi">24</span><span class="p">,</span> 
                        <span class="s1">&#39;mem&#39;</span><span class="p">:</span><span class="s1">&#39;64GB&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;extra&#39;</span><span class="p">:</span> <span class="kc">None</span>
                        <span class="p">}</span>

        <span class="k">elif</span> <span class="n">software</span> <span class="o">==</span> <span class="s1">&#39;fhiaims&#39;</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">theory</span> <span class="o">=</span> <span class="p">{</span> 
                        <span class="s1">&#39;exec&#39;</span><span class="p">:</span> <span class="s1">&#39;/exports/apps/fhi-aims.210226/aims.210226.scalapack.mpi.x&#39;</span><span class="p">,</span> 
                        <span class="s1">&#39;xc&#39;</span><span class="p">:</span> <span class="s1">&#39;pbe&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;basis_set&#39;</span><span class="p">:</span><span class="s1">&#39;light&#39;</span><span class="p">,</span> 
                        <span class="s1">&#39;jobtype&#39;</span><span class="p">:</span><span class="s2">&quot;relax_geometry  trm 5E-3</span><span class="se">\n</span><span class="s2"> sc_accuracy_forces  5E-4</span><span class="se">\n</span><span class="s2"> output_level MD_light&quot;</span><span class="p">,</span>
                        <span class="s1">&#39;disp&#39;</span><span class="p">:</span> <span class="s1">&#39;vdw_correction_hirshfeld&#39;</span><span class="p">,</span> 
                        <span class="s1">&#39;convergence_options&#39;</span><span class="p">:</span>
                                        <span class="s2">&quot;sc_accuracy_rho  1E-4</span><span class="se">\n</span><span class="s2"> sc_accuracy_eev  1E-3</span><span class="se">\n</span><span class="s2"> sc_accuracy_etot 1E-6</span><span class="se">\n</span><span class="s2"> sc_iter_limit    999&quot;</span><span class="p">,</span> 
                        <span class="s1">&#39;charge&#39;</span><span class="p">:</span> <span class="s1">&#39;0.0&#39;</span><span class="p">,</span> 
                        <span class="s1">&#39;density_update_method&#39;</span><span class="p">:</span> <span class="s2">&quot;orbital&quot;</span><span class="p">,</span> 
                        <span class="s1">&#39;nprocs&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> 
                        <span class="s1">&#39;check_cpu_consistency&#39;</span><span class="p">:</span> <span class="s2">&quot;.false.&quot;</span><span class="p">,</span>
                        <span class="s1">&#39;extra&#39;</span> <span class="p">:</span> <span class="kc">None</span>
                        <span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">theory</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span></div>




<div class="viewcode-block" id="Space.sort_energy">
<a class="viewcode-back" href="../../CarP.html#CarP.conf_space.Space.sort_energy">[docs]</a>
    <span class="k">def</span> <span class="nf">sort_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">energy_function</span><span class="o">=</span><span class="s1">&#39;E&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sorted the conformers according to selected energy_function</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">energy_function</span> <span class="o">==</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span>      <span class="bp">self</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">E</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">energy_function</span> <span class="o">==</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span>    <span class="bp">self</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">H</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">energy_function</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span>    <span class="bp">self</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">F</span><span class="p">)</span></div>


<div class="viewcode-block" id="Space.reference_to_zero">
<a class="viewcode-back" href="../../CarP.html#CarP.conf_space.Space.reference_to_zero">[docs]</a>
    <span class="k">def</span> <span class="nf">reference_to_zero</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">energy_function</span><span class="o">=</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;Finds a conformer with the lowest specified energy function and </span>
<span class="sd">        references remaining conformers to this.</span>

<span class="sd">        :param energy_function: (char) either E, F or H. The table will be sorted least to greatest in terms of the energy indicated by this parameter. </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">reference</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span> 

            <span class="n">Eref</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="p">;</span> <span class="n">Fref</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="p">;</span> <span class="n">Href</span> <span class="o">=</span> <span class="mf">0.0</span> 

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;F&#39;</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">energy_function</span> <span class="o">==</span> <span class="s1">&#39;E&#39;</span> <span class="ow">and</span>  <span class="n">conf</span><span class="o">.</span><span class="n">E</span> <span class="o">&lt;</span> <span class="n">Eref</span><span class="p">:</span>
                        <span class="n">Eref</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">E</span><span class="p">)</span> <span class="p">;</span> <span class="n">Href</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">H</span><span class="p">)</span> <span class="p">;</span> <span class="n">Fref</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">F</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">energy_function</span> <span class="o">==</span> <span class="s1">&#39;H&#39;</span> <span class="ow">and</span>  <span class="n">conf</span><span class="o">.</span><span class="n">H</span> <span class="o">&lt;</span> <span class="n">Href</span><span class="p">:</span>
                        <span class="n">Eref</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">E</span><span class="p">)</span> <span class="p">;</span> <span class="n">Href</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">H</span><span class="p">)</span> <span class="p">;</span> <span class="n">Fref</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">F</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">energy_function</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span> <span class="ow">and</span>  <span class="n">conf</span><span class="o">.</span><span class="n">F</span> <span class="o">&lt;</span> <span class="n">Fref</span><span class="p">:</span>
                        <span class="n">Eref</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">E</span><span class="p">)</span> <span class="p">;</span> <span class="n">Href</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">H</span><span class="p">)</span> <span class="p">;</span> <span class="n">Fref</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">F</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span> 
                    <span class="n">conf</span><span class="o">.</span><span class="n">Erel</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">E</span> <span class="o">-</span>  <span class="n">Eref</span><span class="p">;</span>  <span class="n">conf</span><span class="o">.</span><span class="n">Hrel</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">H</span> <span class="o">-</span>  <span class="n">Href</span> <span class="p">;</span>  <span class="n">conf</span><span class="o">.</span><span class="n">Frel</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">F</span> <span class="o">-</span>  <span class="n">Fref</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">energy_function</span> <span class="o">==</span> <span class="s1">&#39;E&#39;</span> <span class="ow">and</span>  <span class="n">conf</span><span class="o">.</span><span class="n">E</span> <span class="o">&lt;</span> <span class="n">Eref</span><span class="p">:</span>
                        <span class="n">Eref</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">E</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span> 
                <span class="n">conf</span><span class="o">.</span><span class="n">Erel</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">E</span> <span class="o">-</span>  <span class="n">Eref</span>

        <span class="k">else</span><span class="p">:</span> 
            <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">reference</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span> 
                    <span class="n">conf</span><span class="o">.</span><span class="n">Erel</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">E</span> <span class="o">-</span>  <span class="n">reference</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>  <span class="n">conf</span><span class="o">.</span><span class="n">Hrel</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">H</span> <span class="o">-</span>  <span class="n">reference</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">;</span>  <span class="n">conf</span><span class="o">.</span><span class="n">Frel</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">F</span> <span class="o">-</span>  <span class="n">reference</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="n">conf</span><span class="o">.</span><span class="n">Erel</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">E</span> <span class="o">-</span> <span class="n">reference</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="Space.print_relative">
<a class="viewcode-back" href="../../CarP.html#CarP.conf_space.Space.print_relative">[docs]</a>
    <span class="k">def</span> <span class="nf">print_relative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alive</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pucker</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">glycosidic_bond</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">output</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prints relative energies of each conformer, related to reference_to_zero</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">output</span><span class="p">:</span> 
            <span class="n">out</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">output</span><span class="p">]),</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
 
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Erel&#39;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span> 
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;run reference_to_zero first&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span> 
         
        <span class="k">if</span>   <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Frel&#39;</span><span class="p">):</span>  <span class="n">out</span><span class="o">.</span><span class="n">write</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:&gt;23s}{1:&gt;16s}{2:&gt;20s}{3:&gt;8s}{4:&gt;8s}{5:&gt;8s}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;topol&#39;</span><span class="p">,</span>  <span class="s1">&#39;F-abs&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Erel&#39;</span><span class="p">):</span>  <span class="n">out</span><span class="o">.</span><span class="n">write</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:&gt;23s}{1:&gt;16s}{2:&gt;20s}{3:&gt;8s}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;topol&#39;</span><span class="p">,</span>  <span class="s1">&#39;E-abs&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">))</span> 
        <span class="k">else</span><span class="p">:</span>                           <span class="n">out</span><span class="o">.</span><span class="n">write</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:&gt;23s}{1:&gt;16s}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;topol&#39;</span><span class="p">))</span>
 
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">conf</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
 
            <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="n">alive</span><span class="p">:</span> <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;---------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">conf</span><span class="o">.</span><span class="n">topol</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span> <span class="n">topol</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">topol</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">topol</span>
 
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Frel&#39;</span><span class="p">):</span>
 
                <span class="k">try</span><span class="p">:</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="s1">&#39;Frel&#39;</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span> <span class="k">continue</span>
                <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:3d}{1:&gt;20s}{2:&gt;16s}{3:20.8f}{4:8.2f}{5:8.2f}{6:8.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">_id</span><span class="p">,</span> <span class="n">topol</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">F</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">Erel</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_Ha2kcal</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">Hrel</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_Ha2kcal</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">Frel</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_Ha2kcal</span><span class="p">))</span>
 
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Erel&#39;</span><span class="p">):</span>
 
                <span class="k">try</span><span class="p">:</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="s1">&#39;Erel&#39;</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span> <span class="k">continue</span>

                <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:3d}{1:&gt;20s}{2:&gt;16s}{3:20.8f}{4:8.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">_id</span><span class="p">,</span> <span class="n">topol</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">E</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">Erel</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_Ha2kcal</span><span class="p">))</span>
  
            <span class="k">else</span><span class="p">:</span>
 
                <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:3d}{1:&gt;20s}{2:&gt;16s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">_id</span><span class="p">,</span> <span class="n">topol</span><span class="p">))</span>
 
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="s1">&#39;ccs&#39;</span><span class="p">):</span>
                <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:8.1f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">ccs</span><span class="p">))</span>
 
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="s1">&#39;anomer&#39;</span><span class="p">):</span>
                <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:&gt;5s}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">anomer</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
 
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="s1">&#39;graph&#39;</span><span class="p">):</span>

                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">conf</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>

                    <span class="n">edge</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">e</span><span class="p">]</span>
                    <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">{0:1d}</span><span class="s2">-&gt;</span><span class="si">{1:1d}</span><span class="s2">:</span><span class="si">{2:&gt;4s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;linker_type&#39;</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="n">glycosidic_bond</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:&gt;6.1f}{1:&gt;6.1f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;dihedral&#39;</span><span class="p">][:</span><span class="mi">2</span><span class="p">]))</span>

                <span class="k">if</span> <span class="n">pucker</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">conf</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                        <span class="n">ring</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
                        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:&gt;5s}{1:6.1f}{2:6.1f}{3:6.1f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ring</span><span class="p">[</span><span class="s1">&#39;pucker&#39;</span><span class="p">],</span> <span class="o">*</span><span class="n">ring</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">]))</span>

                <span class="k">elif</span> <span class="n">pucker</span> <span class="o">==</span> <span class="s1">&#39;pucker&#39;</span><span class="p">:</span> 
                    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">conf</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                        <span class="n">ring</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
                        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:&gt;5s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ring</span><span class="p">[</span><span class="s1">&#39;pucker&#39;</span><span class="p">]))</span>

            <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>




<div class="viewcode-block" id="Space.remove_duplicates">
<a class="viewcode-back" href="../../CarP.html#CarP.conf_space.Space.remove_duplicates">[docs]</a>
    <span class="k">def</span> <span class="nf">remove_duplicates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rmsd</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">Hydrogen</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Removes duplicate conformers from the space</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">Hydrogen</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">atoms</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>
            <span class="n">atoms</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">Hydrogen</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span> 
            <span class="n">atoms</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">Hydrogen</span> <span class="o">==</span> <span class="s2">&quot;polar&quot;</span><span class="p">:</span>
            <span class="n">atoms</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">at</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">atoms</span><span class="p">):</span>

                <span class="k">if</span> <span class="n">at</span> <span class="o">==</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> 
                    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;O&#39;</span> <span class="ow">or</span> <span class="s1">&#39;N&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">adjacent_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">conn_mat</span><span class="p">,</span> <span class="n">n</span><span class="p">)]:</span> <span class="n">atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="n">atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
        <span class="n">to_be_removed</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">conf1</span>  <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">conf2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="p">:</span> <span class="k">continue</span>
                <span class="k">if</span> <span class="n">calculate_rmsd</span><span class="p">(</span><span class="n">conf1</span><span class="p">,</span> <span class="n">conf2</span><span class="p">,</span> <span class="n">atoms</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">rmsd</span><span class="p">:</span>
                    <span class="n">to_be_removed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

        <span class="n">to_be_removed</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">to_be_removed</span><span class="p">))</span>
        <span class="n">to_be_removed</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">to_be_removed</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">rem</span> <span class="ow">in</span> <span class="n">to_be_removed</span><span class="p">:</span>
            <span class="c1">#print(rem)</span>
            <span class="k">del</span> <span class="bp">self</span><span class="p">[</span><span class="n">rem</span><span class="p">]</span></div>


<div class="viewcode-block" id="Space.rmsd_matrix">
<a class="viewcode-back" href="../../CarP.html#CarP.conf_space.Space.rmsd_matrix">[docs]</a>
    <span class="k">def</span> <span class="nf">rmsd_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Hydrogen</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="n">atoms</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Hydrogen</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span> 
            <span class="n">atoms</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>
        <span class="c1">#print(atoms)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rmsd_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">conf1</span>  <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">conf2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rmsd_mat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>  <span class="o">=</span> <span class="n">calculate_rmsd</span><span class="p">(</span><span class="n">conf1</span><span class="p">,</span> <span class="n">conf2</span><span class="p">,</span> <span class="n">atoms</span><span class="p">)</span></div>


<div class="viewcode-block" id="Space.cluster">
<a class="viewcode-back" href="../../CarP.html#CarP.conf_space.Space.cluster">[docs]</a>
    <span class="k">def</span> <span class="nf">cluster</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s2">&quot;cluster&quot;</span><span class="p">,</span> <span class="n">energy_function</span><span class="o">=</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="n">E_cutoff</span><span class="o">=</span><span class="p">[</span><span class="mf">100.00</span><span class="p">],</span> <span class="n">Dist_cutoff</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">E_cutoff</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">Dist_cutoff</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;E_cutoff list longer than Dist_cutoff&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;rmsd_mat&#39;</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmsd_matrix</span><span class="p">(</span><span class="n">Hydrogen</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">Z</span> <span class="o">=</span> <span class="n">linkage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rmsd_mat</span><span class="p">,</span> <span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="n">optimal_ordering</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span> 
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
            <span class="n">dn</span> <span class="o">=</span> <span class="n">dendrogram</span> <span class="p">(</span><span class="n">Z</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;cluster.pdf&#39;</span><span class="p">]),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

        <span class="n">unique_conf</span> <span class="o">=</span> <span class="n">Space</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">load</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">cluster_assign</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">Dist_cutoff</span><span class="p">:</span> 
            <span class="n">cluster_assign</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cut_tree</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">d</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">conf</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

            <span class="n">Erel</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">Erel</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_Ha2kcal</span>
            <span class="k">for</span> <span class="n">ecut</span><span class="p">,</span> <span class="n">dcut</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">E_cutoff</span><span class="p">,</span> <span class="n">cluster_assign</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">Erel</span> <span class="o">&lt;</span> <span class="n">ecut</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span> <span class="n">dcut</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dcut</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span> <span class="p">):</span>
                    <span class="n">unique_conf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">conf</span><span class="p">))</span>
                    <span class="k">break</span> 

        <span class="k">return</span> <span class="n">unique_conf</span> </div>


<div class="viewcode-block" id="Space.calculate_ccs">
<a class="viewcode-back" href="../../CarP.html#CarP.conf_space.Space.calculate_ccs">[docs]</a>
    <span class="k">def</span> <span class="nf">calculate_ccs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;pa&#39;</span><span class="p">,</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Calculates the collision cross section for each conformer. The parameters passed should generally just remain as their defaults values</span>
<span class="sd">f</span>
<span class="sd">        :param methond: (string) pa or ehss, methods of calculation</span>
<span class="sd">        :param accuracy: dont change the default, return a value converged within 1%</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>  <span class="n">conf</span><span class="o">.</span><span class="n">calculate_ccs</span><span class="p">(</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">accuracy</span><span class="o">=</span><span class="n">accuracy</span><span class="p">)</span></div>


<div class="viewcode-block" id="Space.gaussian_broadening">
<a class="viewcode-back" href="../../CarP.html#CarP.conf_space.Space.gaussian_broadening">[docs]</a>
    <span class="k">def</span> <span class="nf">gaussian_broadening</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">broaden</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Performs gaussian broadening for the set</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#works when no load_exp is called, need to test with load_exp</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;self.ir_resolution&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span> <span class="n">conf</span><span class="o">.</span><span class="n">gaussian_broadening</span><span class="p">(</span><span class="n">broaden</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ir_resolution</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span> <span class="n">conf</span><span class="o">.</span><span class="n">gaussian_broadening</span><span class="p">(</span><span class="n">broaden</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="Space.create_connectivity_matrix">
<a class="viewcode-back" href="../../CarP.html#CarP.conf_space.Space.create_connectivity_matrix">[docs]</a>
    <span class="k">def</span> <span class="nf">create_connectivity_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distXX</span><span class="o">=</span><span class="mf">1.6</span><span class="p">,</span> <span class="n">distXH</span><span class="o">=</span><span class="mf">1.2</span><span class="p">):</span> <span class="c1">#1</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a connectivity matrix as an attribute to the conf_space:</span>
<span class="sd">        distXX - cutoff distance between heavy atoms</span>
<span class="sd">        distXH - cutoff distance between heavy at - hydrogen</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;creating connectivity matrix&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span> <span class="n">conf</span><span class="o">.</span><span class="n">connectivity_matrix</span><span class="p">(</span><span class="n">distXX</span><span class="p">,</span> <span class="n">distXH</span><span class="p">)</span></div>


<div class="viewcode-block" id="Space.assign_atoms">
<a class="viewcode-back" href="../../CarP.html#CarP.conf_space.Space.assign_atoms">[docs]</a>
    <span class="k">def</span> <span class="nf">assign_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1">#2</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Labels each atom for each conformer in the space</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;assigning atoms&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span> <span class="n">conf</span><span class="o">.</span><span class="n">assign_atoms</span><span class="p">()</span></div>


<div class="viewcode-block" id="Space.rotate_all_conf">
<a class="viewcode-back" href="../../CarP.html#CarP.conf_space.Space.rotate_all_conf">[docs]</a>
    <span class="k">def</span> <span class="nf">rotate_all_conf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Finds and applies the rotation matrix to each conformer being optimally rotated to match a conformer in the list of space with the index provided</span>
<span class="sd">        :param index: (int) the index in the list of conformers that each confromer will be rotated to match</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#For each conformer store the rotation matrix and which conformer it is rotated to match</span>
        <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">rmsd</span><span class="p">,</span> <span class="n">rotmat</span> <span class="o">=</span> <span class="n">rmsd</span><span class="o">.</span><span class="n">rmsd_qcp</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">xyz</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">xyz</span><span class="p">,</span> <span class="n">rotation_matrix</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">conf</span><span class="o">.</span><span class="n">rotate_conf</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">rotmat</span><span class="p">)</span></div>


<div class="viewcode-block" id="Space.assign_ring_puckers">
<a class="viewcode-back" href="../../CarP.html#CarP.conf_space.Space.assign_ring_puckers">[docs]</a>
    <span class="k">def</span> <span class="nf">assign_ring_puckers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1">#3</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Identifies each ring of each conformer in the space</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;assigning rings&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span> <span class="n">conf</span><span class="o">.</span><span class="n">measure_ring</span><span class="p">()</span> </div>


<div class="viewcode-block" id="Space.assign_glycosidic_angles">
<a class="viewcode-back" href="../../CarP.html#CarP.conf_space.Space.assign_glycosidic_angles">[docs]</a>
    <span class="k">def</span> <span class="nf">assign_glycosidic_angles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the dihedral angles for each conformer in the space</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;assigning dihs&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span> <span class="n">conf</span><span class="o">.</span><span class="n">measure_glycosidic</span><span class="p">()</span></div>



<div class="viewcode-block" id="Space.plot_XE">
<a class="viewcode-back" href="../../CarP.html#CarP.conf_space.Space.plot_XE">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_XE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xdata</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">x_extend</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">energy_function</span><span class="o">=</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="n">ymin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mf">30.</span><span class="p">,</span> <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;Distance [$\AA$]&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">)):</span>


<span class="w">        </span><span class="sd">&quot;&quot;&quot; Coformational free energy vs ccs, for every conformer</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">NullFormatter</span><span class="p">,</span> <span class="n">FormatStrFormatter</span>

        <span class="c1">#color = { &#39;LeA&#39;: &#39;#a6cee3&#39;, &#39;LeX&#39;: &#39;#1f78b4&#39;, &#39;BGH-1&#39;: &#39;#b2df8a&#39;, &#39;BGH-2&#39;: &#39;#33a02c&#39;, &#39;a16&#39;:&#39;#fb9a99&#39;, &#39;b16&#39;:&#39;#e31a1c&#39;, &#39;a14&#39;:&#39;#fdbf6f&#39; , &#39;b14&#39;: &#39;#ff7f00&#39;, &#39;a13&#39;: &#39;#cab2d6&#39;, &#39;b13&#39;: &#39;#6a3d9a&#39;,&#39;a16n&#39;:&#39;#ffff99&#39;,&#39;b16n&#39;:&#39;#b15928&#39;, &#39;a12n&#39;: &#39;#000000&#39;}</span>
        <span class="c1">#marker ={ &#39;LeX&#39;: &#39;o&#39;,       &#39;LeA&#39;: &#39;o&#39;      , &#39;BGH-2&#39;: &#39;o&#39;      , &#39;BGH-1&#39;:&#39;o&#39;      , &#39;a16&#39;: &#39;o&#39;,       &#39;b16&#39;:&#39;o&#39;      , &#39;a14&#39;: &#39;o&#39;      , &#39;b14&#39;: &#39;o&#39;      , &#39;a13&#39;: &#39;o&#39;      , &#39;b13&#39;: &#39;o&#39;      ,&#39;a16n&#39;:&#39;o&#39;      ,&#39;b16n&#39;:&#39;o&#39;      , &#39;a12n&#39;: &#39;o&#39;      }</span>

        <span class="n">color</span> <span class="o">=</span>  <span class="p">[</span> <span class="s1">&#39;#a6cee3&#39;</span><span class="p">,</span> <span class="s1">&#39;#1f78b4&#39;</span><span class="p">,</span> <span class="s1">&#39;#b2df8a&#39;</span><span class="p">,</span><span class="s1">&#39;#33a02c&#39;</span><span class="p">,</span> <span class="s1">&#39;#fb9a99&#39;</span><span class="p">,</span> <span class="s1">&#39;#e31a1c&#39;</span><span class="p">,</span> <span class="s1">&#39;#fdbf6f&#39;</span> <span class="p">,</span> <span class="s1">&#39;#ff7f00&#39;</span><span class="p">,</span> <span class="s1">&#39;#cab2d6&#39;</span><span class="p">,</span> <span class="s1">&#39;#6a3d9a&#39;</span><span class="p">,</span> <span class="s1">&#39;#ffff99&#39;</span><span class="p">,</span><span class="s1">&#39;#b15928&#39;</span><span class="p">]</span>
        <span class="c1">#color = [&#39;#1f78b4&#39;, &#39;#e31a1c&#39;, &#39;#33a02c&#39;,&#39;#ff7f00&#39;]</span>
        <span class="c1">#color = [&#39;#a6cee3&#39;, &#39;#1f78b4&#39;, &#39;#fb9a99&#39;, &#39;#e31a1c&#39;]</span>


        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">conf</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">topol</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="n">Hs_label</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="s1">&#39;unknown&#39;</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>  
            <span class="n">labels</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;unknown&#39;</span><span class="p">)</span> 
            <span class="n">Hs_label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;unknown&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span> 
            <span class="k">if</span> <span class="n">l</span> <span class="ow">and</span> <span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;_Hs&#39;</span> <span class="ow">or</span> <span class="n">l</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;_M&#39;</span><span class="p">):</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> 
                <span class="n">Hs_label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">l</span> <span class="ow">and</span> <span class="n">l</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;kg&#39;</span><span class="p">:</span> <span class="n">l</span> <span class="o">=</span> <span class="n">l</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>

        <span class="n">color</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">color</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">Hs_label</span><span class="p">:</span> 
            <span class="n">color</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;#000000&#39;</span>

        <span class="c1">#color = {}</span>
        <span class="n">color</span><span class="p">[</span><span class="s1">&#39;unknown&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;#000000&#39;</span>
        <span class="n">color</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">=</span>      <span class="s1">&#39;#000000&#39;</span>

        <span class="c1">#print(color)</span>

        <span class="c1">#[&#39;#a6cee3&#39;,&#39;#1f78b4&#39;,&#39;#b2df8a&#39;,&#39;#33a02c&#39;,&#39;#fb9a99&#39;,&#39;#e31a1c&#39;,&#39;#fdbf6f&#39;,&#39;#ff7f00&#39;,&#39;#cab2d6&#39;,&#39;#6a3d9a&#39;,&#39;#ffff99&#39;,&#39;#b15928&#39;]</span>
        <span class="n">nullfmt</span> <span class="o">=</span> <span class="n">NullFormatter</span><span class="p">()</span>         <span class="c1"># no labels</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
 
        <span class="k">if</span> <span class="n">exp</span> <span class="p">:</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">exp</span><span class="p">,</span> <span class="n">exp</span><span class="p">],</span> <span class="p">[</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">xdata</span> <span class="o">==</span> <span class="s1">&#39;ccs&#39;</span><span class="p">:</span> 
            <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">energy_function</span> <span class="o">==</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">ccs</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">Erel</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_Ha2kcal</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">[</span><span class="n">conf</span><span class="o">.</span><span class="n">topol</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">topol</span><span class="p">)</span>
   
                <span class="k">elif</span> <span class="n">energy_function</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">ccs</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">Frel</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_Ha2kcal</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">[</span><span class="n">conf</span><span class="o">.</span><span class="n">topol</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">topol</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">xdata</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="c1">#pair distance between atoms</span>

           <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="n">measure_distance</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">xdata</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">energy_function</span> <span class="o">==</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">Erel</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_Ha2kcal</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">[</span><span class="n">conf</span><span class="o">.</span><span class="n">topol</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">topol</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">energy_function</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">Frel</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_Ha2kcal</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">[</span><span class="n">conf</span><span class="o">.</span><span class="n">topol</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">topol</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">xdata</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span> <span class="c1">#angle</span>

           <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="n">measure_angle</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">xdata</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">energy_function</span> <span class="o">==</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">Erel</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_Ha2kcal</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">[</span><span class="n">conf</span><span class="o">.</span><span class="n">topol</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">topol</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">energy_function</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">Frel</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_Ha2kcal</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">[</span><span class="n">conf</span><span class="o">.</span><span class="n">topol</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">topol</span><span class="p">)</span>


        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">xdata</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span> <span class="c1">#dihedral</span>

           <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="n">measure_dihedral</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">xdata</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">energy_function</span> <span class="o">==</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">Erel</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_Ha2kcal</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">[</span><span class="n">conf</span><span class="o">.</span><span class="n">topol</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">topol</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">energy_function</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">Frel</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_Ha2kcal</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">[</span><span class="n">conf</span><span class="o">.</span><span class="n">topol</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">topol</span><span class="p">)</span>

        <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
        <span class="n">by_label</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">handles</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>  <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">by_label</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">by_label</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

        <span class="k">if</span>   <span class="n">energy_function</span> <span class="o">==</span> <span class="s1">&#39;E&#39;</span> <span class="p">:</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;$\Delta$E PBE0+D3 [kcal/mol]&#39;</span>
        <span class="k">elif</span> <span class="n">energy_function</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span>  <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;$\Delta$F PBE0+D3 [kcal/mol]&#39;</span>

        <span class="k">if</span>    <span class="n">xlabel</span> <span class="o">==</span> <span class="s1">&#39;pa&#39;</span> <span class="p">:</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;CCS$^</span><span class="si">{PA}</span><span class="s1">$ [$\AA</span><span class="si">{}</span><span class="s1">^2$]&#39;</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span> <span class="p">;</span> 
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">yaxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ymin</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
        <span class="n">xaxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="n">x_extend</span> <span class="o">=</span> <span class="n">x_extend</span> 
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="o">-</span><span class="n">x_extend</span><span class="p">,</span> <span class="n">xmax</span><span class="o">+</span><span class="n">x_extend</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xaxis</span><span class="p">);</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">yaxis</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;16&#39;</span><span class="p">);</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">yaxis</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;16&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">]:</span> <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">)</span> <span class="p">;</span>  <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.0f</span><span class="s1">&#39;</span><span class="p">))</span> <span class="p">;</span>  <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span><span class="p">))</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xmin</span><span class="o">-</span><span class="n">x_extend</span><span class="p">,</span><span class="n">xmax</span><span class="o">+</span><span class="n">x_extend</span><span class="p">],</span> <span class="p">[</span><span class="n">ymin</span><span class="o">+</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">ymin</span><span class="o">+</span><span class="mf">0.05</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xmin</span><span class="o">-</span><span class="n">x_extend</span><span class="o">+</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">xmin</span><span class="o">-</span><span class="n">x_extend</span><span class="o">+</span><span class="mf">0.05</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">ymax</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">output</span><span class="p">:</span> 
            <span class="c1">#fig.savefig(&#39;/&#39;.join([output, &#39;ccs_plot.png&#39;]), dpi=200, transparent=True)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">output</span><span class="p">,</span> <span class="s1">&#39;ccs_plot.pdf&#39;</span><span class="p">]),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;ccs_plot.pdf&#39;</span><span class="p">]),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="Space.plot_puckers">
<a class="viewcode-back" href="../../CarP.html#CarP.conf_space.Space.plot_puckers">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_puckers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ring_number</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">energy_function</span><span class="o">=</span><span class="s1">&#39;E&#39;</span><span class="p">):</span>
   
        <span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">NullFormatter</span><span class="p">,</span> <span class="n">FormatStrFormatter</span>
       
        <span class="n">nullfmt</span> <span class="o">=</span> <span class="n">NullFormatter</span><span class="p">()</span>         <span class="c1"># no labels</span>
 
        <span class="k">def</span> <span class="nf">reduce_pucker</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>

            <span class="n">xaxis</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;4C1&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;1C4&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span><span class="mi">5</span> <span class="p">}</span>
            <span class="n">S</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1S3&#39;</span><span class="p">,</span> <span class="s1">&#39;3S1&#39;</span><span class="p">,</span> <span class="s1">&#39;2S6&#39;</span><span class="p">,</span> <span class="s1">&#39;6S2&#39;</span><span class="p">,</span><span class="s1">&#39;5S1&#39;</span><span class="p">,</span> <span class="s1">&#39;1S5&#39;</span><span class="p">]</span>
            <span class="n">B</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;B1,4&#39;</span><span class="p">,</span> <span class="s1">&#39;B3,6&#39;</span><span class="p">,</span> <span class="s1">&#39;3,6B&#39;</span><span class="p">,</span> <span class="s1">&#39;1,4B&#39;</span><span class="p">,</span> <span class="s1">&#39;2,5B&#39;</span><span class="p">,</span> <span class="s1">&#39;B2,5&#39;</span><span class="p">]</span>
            <span class="n">H</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;6H5&#39;</span><span class="p">,</span> <span class="s1">&#39;5H6&#39;</span><span class="p">,</span> <span class="s1">&#39;6H1&#39;</span><span class="p">,</span> <span class="s1">&#39;1H6&#39;</span><span class="p">,</span> <span class="s1">&#39;1H2&#39;</span><span class="p">,</span> <span class="s1">&#39;2H1&#39;</span><span class="p">,</span> <span class="s1">&#39;2H3&#39;</span><span class="p">,</span> <span class="s1">&#39;3H2&#39;</span><span class="p">,</span> <span class="s1">&#39;3H4&#39;</span><span class="p">,</span> <span class="s1">&#39;4H3&#39;</span><span class="p">,</span> <span class="s1">&#39;4H5&#39;</span><span class="p">,</span> <span class="s1">&#39;5H4&#39;</span><span class="p">]</span>
            <span class="n">E</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;E&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">)]</span>
 
            <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;4C1&#39;</span><span class="p">,</span> <span class="s1">&#39;1C4&#39;</span><span class="p">]:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">S</span><span class="p">:</span> <span class="n">p</span> <span class="o">=</span> <span class="s1">&#39;S&#39;</span>
            <span class="k">elif</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">B</span><span class="p">:</span> <span class="n">p</span> <span class="o">=</span> <span class="s1">&#39;B&#39;</span>
            <span class="k">elif</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">H</span><span class="p">:</span> <span class="n">p</span> <span class="o">=</span> <span class="s1">&#39;H&#39;</span>
            <span class="k">elif</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">E</span><span class="p">:</span> <span class="n">p</span> <span class="o">=</span> <span class="s1">&#39;E&#39;</span>
            <span class="k">return</span> <span class="n">xaxis</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
 
 
        <span class="k">if</span> <span class="n">ring_number</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span> 
 
            <span class="n">nrings</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
            
            <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nrings</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">nrings</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
       
            <span class="k">if</span>   <span class="n">energy_function</span> <span class="o">==</span> <span class="s1">&#39;E&#39;</span> <span class="p">:</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;$\Delta$E PBE0+D3 [kcal/mol]&#39;</span>
            <span class="k">elif</span> <span class="n">energy_function</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span>  <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;$\Delta$F PBE0+D3 [kcal/mol]&#39;</span>
 
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
 
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
                <span class="n">yaxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ymin</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>
       
                <span class="n">xmin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">xmax</span> <span class="o">=</span> <span class="mi">5</span>
                <span class="n">xaxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
                <span class="n">x_extend</span> <span class="o">=</span> <span class="mf">0.5</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="o">-</span><span class="n">x_extend</span><span class="p">,</span> <span class="n">xmax</span><span class="o">+</span><span class="n">x_extend</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span>
       
                <span class="n">puckers</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$^4$C$_1$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$^1$C$_4$&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">]</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xaxis</span><span class="o">+</span><span class="mf">0.5</span><span class="p">);</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">yaxis</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">puckers</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;16&#39;</span><span class="p">);</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">yaxis</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;16&#39;</span><span class="p">)</span>
       
                <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">]:</span> <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span><span class="p">))</span>
       
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xmin</span><span class="o">-</span><span class="n">x_extend</span><span class="p">,</span><span class="n">xmax</span><span class="o">+</span><span class="n">x_extend</span><span class="o">+</span><span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="n">ymin</span><span class="o">+</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">ymin</span><span class="o">+</span><span class="mf">0.05</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xmin</span><span class="o">-</span><span class="n">x_extend</span><span class="o">+</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">xmin</span><span class="o">-</span><span class="n">x_extend</span><span class="o">+</span><span class="mf">0.05</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">ymax</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
 
       
                <span class="n">w</span> <span class="o">=</span> <span class="mf">0.2</span>
                <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">reduce_pucker</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;pucker&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">energy_function</span> <span class="o">==</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="n">E</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">Erel</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_Ha2kcal</span> 
                    <span class="k">elif</span> <span class="n">energy_function</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span> <span class="p">:</span> <span class="n">E</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">Frel</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_Ha2kcal</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">p</span><span class="o">+</span><span class="n">w</span><span class="p">,</span> <span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="n">w</span><span class="p">],</span> <span class="p">[</span><span class="n">E</span><span class="p">,</span> <span class="n">E</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
           
            <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">output</span><span class="p">:</span> 
                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">output</span><span class="p">,</span> <span class="s1">&#39;ring_puckers.pdf&#39;</span><span class="p">]),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;ring_puckers.pdf&#39;</span><span class="p">]),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span> 

            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

            <span class="k">if</span>   <span class="n">energy_function</span> <span class="o">==</span> <span class="s1">&#39;E&#39;</span> <span class="p">:</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;$\Delta$E PBE0+D3 [kcal/mol]&#39;</span>
            <span class="k">elif</span> <span class="n">energy_function</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span>  <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;$\Delta$F PBE0+D3 [kcal/mol]&#39;</span>


            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
            <span class="n">yaxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ymin</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>

            <span class="n">xmin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">xmax</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="n">xaxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
            <span class="n">x_extend</span> <span class="o">=</span> <span class="mf">0.5</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="o">-</span><span class="n">x_extend</span><span class="p">,</span> <span class="n">xmax</span><span class="o">+</span><span class="n">x_extend</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span>

            <span class="n">puckers</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$^4$C$_1$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$^1$C$_4$&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xaxis</span><span class="o">+</span><span class="mf">0.5</span><span class="p">);</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">yaxis</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">puckers</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;16&#39;</span><span class="p">);</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">yaxis</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;16&#39;</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">]:</span> <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span><span class="p">))</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xmin</span><span class="o">-</span><span class="n">x_extend</span><span class="p">,</span><span class="n">xmax</span><span class="o">+</span><span class="n">x_extend</span><span class="o">+</span><span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="n">ymin</span><span class="o">+</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">ymin</span><span class="o">+</span><span class="mf">0.05</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xmin</span><span class="o">-</span><span class="n">x_extend</span><span class="o">+</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">xmin</span><span class="o">-</span><span class="n">x_extend</span><span class="o">+</span><span class="mf">0.05</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">ymax</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>

            <span class="n">w</span> <span class="o">=</span> <span class="mf">0.2</span>
            <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">reduce_pucker</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">ring_number</span><span class="p">][</span><span class="s1">&#39;pucker&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">energy_function</span> <span class="o">==</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="n">E</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">Erel</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_Ha2kcal</span>
                <span class="k">elif</span> <span class="n">energy_function</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span> <span class="p">:</span> <span class="n">E</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">Frel</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_Ha2kcal</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">p</span><span class="o">+</span><span class="n">w</span><span class="p">,</span> <span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="n">w</span><span class="p">],</span> <span class="p">[</span><span class="n">E</span><span class="p">,</span> <span class="n">E</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
       
            <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">output</span><span class="p">:</span> 
                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">output</span><span class="p">,</span> <span class="s1">&#39;ring_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ring_number</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.pdf&#39;</span><span class="p">]),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;ring_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ring_number</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.pdf&#39;</span><span class="p">]),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="Space.plot_glycosidic_bond">
<a class="viewcode-back" href="../../CarP.html#CarP.conf_space.Space.plot_glycosidic_bond">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_glycosidic_bond</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">angles</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="mf">20.0</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues_r&#39;</span><span class="p">,</span> <span class="n">cmap2</span><span class="o">=</span><span class="s1">&#39;Set1&#39;</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">flip_order</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">NullFormatter</span><span class="p">,</span> <span class="n">FormatStrFormatter</span>      

        <span class="k">def</span> <span class="nf">reduce_pucker</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>

            <span class="n">xaxis</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;4C1&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;1C4&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span><span class="mi">5</span> <span class="p">}</span>
            <span class="n">S</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1S3&#39;</span><span class="p">,</span> <span class="s1">&#39;3S1&#39;</span><span class="p">,</span> <span class="s1">&#39;2S6&#39;</span><span class="p">,</span> <span class="s1">&#39;6S2&#39;</span><span class="p">,</span><span class="s1">&#39;5S1&#39;</span><span class="p">,</span> <span class="s1">&#39;1S5&#39;</span><span class="p">]</span>
            <span class="n">B</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;B1,4&#39;</span><span class="p">,</span> <span class="s1">&#39;B3,6&#39;</span><span class="p">,</span> <span class="s1">&#39;3,6B&#39;</span><span class="p">,</span> <span class="s1">&#39;1,4B&#39;</span><span class="p">,</span> <span class="s1">&#39;2,5B&#39;</span><span class="p">,</span> <span class="s1">&#39;B2,5&#39;</span><span class="p">]</span>
            <span class="n">H</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;6H5&#39;</span><span class="p">,</span> <span class="s1">&#39;5H6&#39;</span><span class="p">,</span> <span class="s1">&#39;6H1&#39;</span><span class="p">,</span> <span class="s1">&#39;1H6&#39;</span><span class="p">,</span> <span class="s1">&#39;1H2&#39;</span><span class="p">,</span> <span class="s1">&#39;2H1&#39;</span><span class="p">,</span> <span class="s1">&#39;2H3&#39;</span><span class="p">,</span> <span class="s1">&#39;3H2&#39;</span><span class="p">,</span> <span class="s1">&#39;3H4&#39;</span><span class="p">,</span> <span class="s1">&#39;4H3&#39;</span><span class="p">,</span> <span class="s1">&#39;4H5&#39;</span><span class="p">,</span> <span class="s1">&#39;5H4&#39;</span><span class="p">]</span>
            <span class="n">E</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;E&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">)]</span>

            <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;4C1&#39;</span><span class="p">,</span> <span class="s1">&#39;1C4&#39;</span><span class="p">]:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">S</span><span class="p">:</span> <span class="n">p</span> <span class="o">=</span> <span class="s1">&#39;S&#39;</span>
            <span class="k">elif</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">B</span><span class="p">:</span> <span class="n">p</span> <span class="o">=</span> <span class="s1">&#39;B&#39;</span>
            <span class="k">elif</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">H</span><span class="p">:</span> <span class="n">p</span> <span class="o">=</span> <span class="s1">&#39;H&#39;</span>
            <span class="k">elif</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">E</span><span class="p">:</span> <span class="n">p</span> <span class="o">=</span> <span class="s1">&#39;E&#39;</span>
            <span class="k">return</span> <span class="n">xaxis</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">angles</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span> 
 
            <span class="n">nang</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>
            
            <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nang</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">nang</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="mi">0</span> 
       
            <span class="k">for</span> <span class="n">e</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">,</span> <span class="n">axes</span><span class="p">):</span>
                
                <span class="k">if</span> <span class="n">ylabel</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">:</span> 
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\psi$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
                    <span class="n">ylabel</span> <span class="o">=</span> <span class="mi">1</span>

                <span class="n">yaxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">180.0</span><span class="p">,</span> <span class="mf">180.0</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">180.0</span><span class="p">,</span> <span class="mf">180.0</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">yaxis</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">))</span>
      
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\phi$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
                <span class="n">xaxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">180.0</span><span class="p">,</span> <span class="mf">180.0</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xaxis</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">))</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">;</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_axisbelow</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span> <span class="p">;</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;linker_type&#39;</span><span class="p">])</span> 

                <span class="c1">#for s in [&#39;top&#39;, &#39;right&#39;, &#39;left&#39;, &#39;bottom&#39;]: ax.spines[s].set_visible(False)</span>
                <span class="c1">#ax.xaxis.set_tick_params(direction=&#39;out&#39;)</span>
                <span class="c1">#ax.yaxis.set_tick_params(direction=&#39;out&#39;)</span>

                <span class="n">vmin</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="p">;</span> 
                <span class="n">E</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">;</span> <span class="n">phi</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">;</span> <span class="n">psi</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">;</span> <span class="n">P</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="n">phi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;dihedral&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">psi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;dihedral&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">E</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">Erel</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_Ha2kcal</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">color</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span> 
                        <span class="n">P</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reduce_pucker</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">color</span><span class="p">][</span><span class="s1">&#39;pucker&#39;</span><span class="p">]))</span>

                <span class="k">if</span> <span class="n">flip_order</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">phi</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span> <span class="p">;</span> <span class="n">psi</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span> <span class="p">;</span> <span class="n">E</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">color</span> <span class="o">==</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> 
                    <span class="n">plot</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap2</span><span class="p">,</span> <span class="n">levels</span><span class="p">)</span>
                    <span class="n">plot</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

            <span class="c1">#fig.colorbar(cmap, ax=axes[:], location=&#39;right&#39;, shrink=1.0)</span>

            <span class="k">if</span> <span class="n">color</span> <span class="o">==</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> 
                <span class="n">cb_ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
                <span class="n">cb</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[:],</span> <span class="n">ticks</span><span class="o">=</span><span class="n">cb_ticks</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span> <span class="s2">&quot;</span><span class="si">{0:5.1f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cb_ticks</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span> 
                <span class="n">cb_ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">vmin</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">levels</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">levels</span><span class="p">)</span> 
                <span class="n">cb</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[:],</span> <span class="n">ticks</span><span class="o">=</span><span class="n">cb_ticks</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="sa">r</span><span class="s1">&#39;$^4$C$_1$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$^1$C$_4$&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

            <span class="c1">#fig.tight_layout()</span>
            <span class="k">if</span> <span class="n">output</span><span class="p">:</span> 
                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">output</span><span class="p">,</span> <span class="s1">&#39;dihedrals_all.pdf&#39;</span><span class="p">]),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;dihedrals_all.pdf&#39;</span><span class="p">]),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span> 

            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\psi$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
            <span class="n">yaxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">180.0</span><span class="p">,</span> <span class="mf">180.0</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">180.0</span><span class="p">,</span> <span class="mf">180.0</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">yaxis</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">))</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\phi$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
            <span class="n">xaxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">180.0</span><span class="p">,</span> <span class="mf">180.0</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xaxis</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">))</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">;</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span> <span class="p">;</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_axisbelow</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">angles</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">):</span> <span class="k">pass</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;linker_type&#39;</span><span class="p">])</span>

            <span class="n">vmin</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="p">;</span>
            <span class="n">E</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">;</span> <span class="n">phi</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">;</span> <span class="n">psi</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">;</span> <span class="n">P</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">phi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;dihedral&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">psi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;dihedral&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">E</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">Erel</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_Ha2kcal</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">color</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
                    <span class="n">P</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reduce_pucker</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">color</span><span class="p">][</span><span class="s1">&#39;pucker&#39;</span><span class="p">]))</span>

            <span class="k">if</span> <span class="n">flip_order</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span> 
                <span class="n">phi</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span> <span class="p">;</span> <span class="n">psi</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span> <span class="p">;</span> <span class="n">E</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">color</span> <span class="o">==</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span>
                <span class="n">plot</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap2</span><span class="p">,</span> <span class="n">levels</span><span class="p">)</span>
                <span class="n">plot</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

       <span class="c1">#fig.colorbar(cmap, ax=axes[:], location=&#39;right&#39;, shrink=1.0)</span>

            <span class="k">if</span> <span class="n">color</span> <span class="o">==</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span>
                <span class="n">cb_ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
                <span class="n">cb</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">cb_ticks</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>  <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span> <span class="s2">&quot;</span><span class="si">{0:5.1f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cb_ticks</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cb_ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">vmin</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">levels</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">levels</span><span class="p">)</span>
                <span class="n">cb</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">cb_ticks</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>  <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="sa">r</span><span class="s1">&#39;$^4$C$_1$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$^1$C$_4$&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
 
            <span class="c1">#fig.tight_layout()</span>
            <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">output</span><span class="p">,</span> <span class="s1">&#39;dihedrals_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.pdf&#39;</span><span class="p">]),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;dihedrals_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.pdf&#39;</span><span class="p">]),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Eugene Chung, Shonel Rahim, Murat Yaman, Mateusz Marianski.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>